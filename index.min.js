!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("core-js/modules/es.object.assign.js"),require("core-js/modules/es.function.bind.js"),require("core-js/modules/es.array.join.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.string.split.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.array.for-each.js"),require("core-js/modules/web.dom-collections.for-each.js"),require("core-js/modules/es.array.flat-map.js"),require("core-js/modules/es.array.unscopables.flat-map.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.array.iterator.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.promise.js"),require("core-js/modules/es.string.iterator.js"),require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/es.set.js"),require("core-js/modules/es.array.sort.js"),require("core-js/modules/es.array.reverse.js"),require("core-js/modules/es.parse-float.js"),require("core-js/modules/es.object.keys.js"),require("core-js/modules/es.string.replace.js"),require("core-js/modules/es.array.includes.js")):"function"==typeof define&&define.amd?define(["core-js/modules/es.object.assign.js","core-js/modules/es.function.bind.js","core-js/modules/es.array.join.js","core-js/modules/es.array.concat.js","core-js/modules/es.regexp.exec.js","core-js/modules/es.string.split.js","core-js/modules/es.array.map.js","core-js/modules/es.array.filter.js","core-js/modules/es.array.for-each.js","core-js/modules/web.dom-collections.for-each.js","core-js/modules/es.array.flat-map.js","core-js/modules/es.array.unscopables.flat-map.js","core-js/modules/es.array.find.js","core-js/modules/es.array.iterator.js","core-js/modules/es.object.to-string.js","core-js/modules/es.promise.js","core-js/modules/es.string.iterator.js","core-js/modules/web.dom-collections.iterator.js","core-js/modules/es.set.js","core-js/modules/es.array.sort.js","core-js/modules/es.array.reverse.js","core-js/modules/es.parse-float.js","core-js/modules/es.object.keys.js","core-js/modules/es.string.replace.js","core-js/modules/es.array.includes.js"],i):(t="undefined"!=typeof globalThis?globalThis:t||self).animatedSwimmerPlot=i()}(this,(function(){"use strict";function t(t,i,n,e,r,s,a){try{var o=t[s](a),l=o.value}catch(t){return void n(t)}o.done?i(l):Promise.resolve(l).then(e,r)}function i(i){return function(){var n=this,e=arguments;return new Promise((function(r,s){var a=i.apply(n,e);function o(i){t(a,r,s,o,l,"next",i)}function l(i){t(a,r,s,o,l,"throw",i)}o(void 0)}))}}function n(t,i,n){return i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t}function e(t,i){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);i&&(e=e.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),n.push.apply(n,e)}return n}function r(t){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?e(Object(r),!0).forEach((function(i){n(t,i,r[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))}))}return t}function s(t,i){if(t!==i)throw new TypeError("Cannot instantiate an arrow function")}function a(t,i){return function(t){if(Array.isArray(t))return t}(t)||function(t,i){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var e,r,s=[],a=!0,o=!1;try{for(n=n.call(t);!(a=(e=n.next()).done)&&(s.push(e.value),!i||s.length!==i);a=!0);}catch(t){o=!0,r=t}finally{try{a||null==n.return||n.return()}finally{if(o)throw r}}return s}(t,i)||l(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,i){if(t){if("string"==typeof t)return c(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,i):void 0}}function c(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,e=new Array(i);n<i;n++)e[n]=t[n];return e}function u(t,i){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=l(t))||i&&t&&"number"==typeof t.length){n&&(t=n);var e=0,r=function(){};return{s:r,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){o=!0,s=t},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}var h={addElement:function(t,i){var n=this,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"div",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(t,i){return s(this,n),i}.bind(this);return r?i.selectAll("".concat(e,".asp-").concat(t,".asp-").concat(e)).data(r,a).join(e).classed("asp-".concat(t," asp-").concat(e),!0):i.append(e).classed("asp-".concat(t," asp-").concat(e),!0)},addIcon:function(t,i){Math.max(i[0],i[1]);var n=this.settings.buttonSize/Math.max(i[0],i[1]),e=this.settings.buttonSize-i[0]*n,r=this.settings.buttonSize-i[1]*n;return t.append("svg").attr("width","".concat(this.settings.buttonSize,"px")).attr("height","".concat(this.settings.buttonSize,"px")).append("g").append("path").attr("transform","translate(".concat(e/2,",").concat(r/2,") scale(").concat(n,")")).attr("d",i[4])}};function d(t){var i=t.node().clientWidth-20;return{width:i,height:i*screen.height/screen.width*3/4}}
/*!
     * Font Awesome Free 5.15.3 by @fontawesome - https://fontawesome.com
     * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
     */var f={prefix:"fas",iconName:"pause",icon:[448,512,[],"f04c","M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"]},g={prefix:"fas",iconName:"play",icon:[448,512,[],"f04b","M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"]},p=[512,512,[],"f01e","M500.33 0h-47.41a12 12 0 0 0-12 12.57l4 82.76A247.42 247.42 0 0 0 256 8C119.34 8 7.9 119.53 8 256.19 8.1 393.07 119.1 504 256 504a247.1 247.1 0 0 0 166.18-63.91 12 12 0 0 0 .48-17.43l-34-34a12 12 0 0 0-16.38-.55A176 176 0 1 1 402.1 157.8l-101.53-4.87a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12h200.33a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12z"],m=[448,512,[],"f048","M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"],v=[448,512,[],"f051","M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"];function b(){console.log(this.settings.play?"pause":"play"),this.settings.play=!this.settings.play,this.controls.playPause.attr("title",this.settings.play?"Pause animation":"Play animation"),this.controls.playPause.select("path").attr("d",(this.settings.play?f:g).icon[4])}function y(t){var i=this;return new Set(t.map(function(t){return s(this,i),t.id}.bind(this)))}function x(t){var i=this;return d3.rollups(t.filter(function(t){return s(this,i),!/Unscheduled/.test(t.visit)}.bind(this)),function(t){var n=this;return s(this,i),d3.median(t,function(t){return s(this,n),t.timepoint}.bind(this))}.bind(this),function(t){return s(this,i),t.visit}.bind(this))}function w(t){var i=this,n=o(new Set(t.map(function(t){return s(this,i),"".concat(t.result_order,"|").concat(t.result,"|").concat(t.result_color)}.bind(this))).values()).map(function(t){return s(this,i),[+t.split("|")[0],t.split("|")[1],t.split("|")[2]]}.bind(this)).sort(function(t,n){return s(this,i),a(t,1)[0]-a(n,1)[0]}.bind(this));return{result:n.map(function(t){s(this,i);var n=a(t,3);n[0];var e=n[1];return n[2],e}.bind(this)),result_color:n.map(function(t){s(this,i);var n=a(t,3);return n[0],n[1],n[2]}.bind(this))}}function j(){return r({id:y.call(this,this.data.mutated),visit:x.call(this,this.data.mutated)},w.call(this,this.data.mutated))}function k(t){return d3.scaleLinear().domain([0,1]).range(t)}function _(t){return d3.scaleBand().domain(d3.range(t.size).reverse()).range([this.settings.height-this.settings.margin.bottom,this.settings.margin.top]).padding(this.settings.padding)}function E(){return d3.scaleOrdinal().domain(this.set.result).range(this.set.result_color.length>1?this.set.result_color.concat(d3.schemeTableau10):d3.schemeTableau10)}function S(){return{x:k.call(this,[this.settings.margin.left,this.settings.width-this.settings.margin.right]),y:_.call(this,this.set.id),color:E.call(this)}}function A(){var t=this,i=128,n=64,e=this.layout.legend.selectAll("div").data(this.scale.color.domain()).join("div").style("display","inline-block");return e.each((function(e,r){var a=this,o=d3.select(this).append("svg").attr("width","".concat(i,"px")).attr("height","".concat(n,"px"));0===r&&o.append("text").attr("x",0).attr("y",0).attr("alignment-baseline","hanging").attr("fill","black").style("font-weight","bold").style("font-size",16).text(t.settings.criteria),o.append("rect").attr("x",0).attr("y",16).attr("width",i).attr("height",n).attr("fill",function(i){return s(this,a),t.scale.color(i)}.bind(this)),o.append("text").attr("x",64).attr("y",32).attr("text-anchor","middle").attr("alignment-baseline","hanging").attr("fill","white").style("font-weight","bold").style("font-size",n/3).text(function(t){return s(this,a),t}.bind(this))})),{width:i,container:this.layout.legend,swatches:e}}function O(t){var i=this,n=this.util.addElement("canvas",this.layout.plots).classed("asp-canvas--".concat(this.settings.split),!0),e=this.util.addElement("svg",n,"svg").attr("width",t.settings.width).attr("height",this.settings.height);return{canvas:n,svg:e,title:this.util.addElement("g--title",e,"g").attr("transform",function(n){return s(this,i),"translate(".concat(t.settings.translateX,",").concat(t.settings.margin.top/2,")")}.bind(this)).append("text").attr("text-anchor",t.i%2==0?"end":"start").attr("alignment-baseline","middle").attr("x",-5*t.settings.sign).attr("y",5).text(""!==t.stratum?"".concat(t.stratum):null),n:this.util.addElement("g--n",e,"g").attr("transform",function(n){return s(this,i),"translate(".concat(t.settings.translateX,",").concat(this.settings.margin.top/2,")")}.bind(this)).append("text").attr("text-anchor","middle").attr("alignment-baseline","middle").attr("x",t.settings.sign*t.settings.strokeWidth/2).attr("y",5),groups:this.util.addElement("g--groups",e,"g").style("font","bold 12px var(--sans-serif)").style("font-variant-numeric","tabular-nums").attr("stroke-opacity",.6).attr("fill-opacity",1),bars:this.util.addElement("g--bars",e,"g").attr("fill-opacity",.6),xAxisTop:this.util.addElement("g--x-axis",e,"g").attr("transform","translate(0,".concat(this.settings.margin.top,")")),xAxisBottom:this.util.addElement("g--x-axis",e,"g").attr("transform","translate(0,".concat(this.settings.height-this.settings.margin.bottom,")")).call(function(n){return s(this,i),this.util.addElement("x-axis__label",n,"text").attr("x",t.settings.mirror?t.settings.width-t.settings.margin.right-18:t.settings.margin.left+18).attr("y",25).attr("fill","currentColor").attr("text-anchor",t.settings.mirror?"end":"start").attr("alignment-baseline","hanging").text(t.settings.mirror?"← Time (days)":"Time (days) →")}.bind(this)),yAxis:this.util.addElement("g--y-axis",e,"g").attr("transform","translate(".concat(this.settings.margin.left,",0)")),labels:this.util.addElement("g--labels",e,"g").style("font","bold 12px var(--sans-serif)").style("font-variant-numeric","tabular-nums").attr("text-anchor","start")}}function L(t,i){var n=this;return{mutated:t,interpolated:this.data.interpolated.filter(function(t){return s(this,n),t.stratum===i}.bind(this)),timepoints:this.data.timepoints.map(function(t){var e=this;s(this,n);var r=a(t,2),o=r[0],l=r[1].filter(function(t){return s(this,e),t.stratum===i}.bind(this)).sort(function(t,i){return s(this,e),t["rank".concat(this.settings.view)]-i["rank".concat(this.settings.view)]}.bind(this));return l.forEach(function(t,n){s(this,e),t["rank".concat(i)]=n}.bind(this)),[o,l]}.bind(this))}}function M(t,i){var n=this;return d3.rollups(i,function(i){var e=this;return s(this,n),i.sort(function(i,n){return s(this,e),i["rank".concat(t.stratum)]-n["rank".concat(t.stratum)]}.bind(this)),{state:i[0].state,state_order:i[0].state_order,n:i.length,rankMin:i[0]["rank".concat(t.stratum)],rankMax:i[i.length-1]["rank".concat(t.stratum)],pct:d3.format(".0%")(i.length/t.set.id.size)}}.bind(this),function(t){return s(this,n),t.state}.bind(this))}function z(t){var i=this,n=t.layout.groups.selectAll("g");return function(e,r){var o=this;s(this,i);var l=a(e,2);l[0];var c=l[1];return n=n.data(M.call(this,t,c),function(t){return s(this,o),t[0]}.bind(this)).join(function(i){var n=this;return s(this,o),i.append("g").attr("transform",function(i){return s(this,n),"translate(".concat(t.settings.translateX,",").concat(t.scale.y(i[1].rankMin),")")}.bind(this)).call(function(i){var e=this;s(this,n),i.append("line").classed("asp-line asp-line--group",!0).attr("x1",t.settings.sign*t.settings.strokeWidth/2).attr("x2",t.settings.sign*t.settings.strokeWidth/2).attr("y1",0).attr("y2",0).attr("stroke",function(t){return s(this,e),this.scale.color(t[0])}.bind(this)).attr("stroke-width",t.settings.strokeWidth-4),i.append("text").classed("asp-text asp-text--percent",!0).attr("text-anchor","middle").attr("alignment-baseline","middle").attr("x",t.settings.sign*t.settings.strokeWidth/2).attr("y",function(i){return s(this,e),(t.scale.y(i[1].rankMax)-t.scale.y(i[1].rankMin))/2+t.scale.y.bandwidth()/2+1}.bind(this)).text(function(t){return s(this,e),"".concat(t[1].n," (").concat(t[1].pct,")")}.bind(this))}.bind(this))}.bind(this),function(t){return s(this,o),t}.bind(this),function(t){s(this,o),t.select("line.asp-line--group").transition(r).duration(this.settings.duration).attr("y2",0),t.transition(r).duration(this.settings.duration).attr("stroke-opacity",0).attr("fill-opacity",0).remove()}.bind(this)).call(function(i){var n=this;s(this,o),i.transition(r).duration(this.settings.duration).attr("transform",function(i){return s(this,n),"translate(".concat(t.settings.translateX,",").concat(t.scale.y(i[1].rankMin),")")}.bind(this)),i.select("text.asp-text--percent").transition(r).duration(this.settings.duration).attr("y",function(i){return s(this,n),(t.scale.y(i[1].rankMax)-t.scale.y(i[1].rankMin))/2+t.scale.y.bandwidth()/2+1}.bind(this)).style("display",(function(i){var n=window.getComputedStyle(this,null).getPropertyValue("font-size"),e=parseFloat(n);return i[1].n*t.scale.y.bandwidth()>e?null:"none"})).text(function(t){return s(this,n),"".concat(t[1].n," (").concat(t[1].pct,")")}.bind(this)),i.select("line.asp-line--group").transition(r).duration(this.settings.duration).attr("y2",function(i){return s(this,n),t.scale.y(i[1].rankMax)-t.scale.y(i[1].rankMin)+t.scale.y.bandwidth()}.bind(this))}.bind(this))}.bind(this)}function P(t){var i=this,n=t.layout.bars.selectAll("g"),e=function(n){return s(this,i),t.settings.mirror?t.scale.x(n.start_timepoint+n.duration):t.scale.x(n.start_timepoint)}.bind(this),r=function(n){return s(this,i),t.settings.mirror?t.scale.x(n.start_timepoint)-t.scale.x(n.start_timepoint+n.duration):t.scale.x(n.start_timepoint+n.duration)-t.scale.x(n.start_timepoint)}.bind(this);return function(o,l){var c=this;s(this,i);var u=a(o,2);u[0];var h=u[1];n=n.data(h,function(t){return s(this,c),t.id}.bind(this)).join(function(i){return s(this,c),i.append("g").attr("height",t.scale.y.bandwidth()).attr("y",t.scale.y(t.set.id.size))}.bind(this),function(t){return s(this,c),t}.bind(this),function(i){return s(this,c),i.transition(l).remove().attr("y",t.scale.y(t.set.id.size+1))}.bind(this)).call(function(i){var n=this;s(this,c),i.transition(l).duration(this.settings.duration).attr("transform",function(i){return s(this,n),"translate(".concat(0,",",t.scale.y(i["rank".concat(t.stratum)]),")")}.bind(this)),i.selectAll("rect").data(function(t){return s(this,n),t["states".concat(this.settings.view)]}.bind(this),function(t){return s(this,n),t.sequence}.bind(this)).join("rect").attr("fill",function(t){return s(this,n),this.scale.color(t.state)}.bind(this)).attr("y",0).attr("height",t.scale.y.bandwidth()).attr("rx","4px").attr("ry","4px").call(function(t){var i=this;return s(this,n),t.transition(l).duration(this.settings.duration).attr("x",function(t){return s(this,i),e(t)}.bind(this)).attr("width",function(t){return s(this,i),r(t)}.bind(this))}.bind(this))}.bind(this))}.bind(this)}function T(t){var i=this;return t.xAxisTop=d3.axisTop(t.scale.x).ticks(this.settings.width/160).tickSizeOuter(0).tickSizeInner(-(this.settings.height-this.settings.margin.top-this.settings.margin.bottom)),t.xAxisBottom=d3.axisBottom(t.scale.x).ticks(this.settings.width/160).tickSizeOuter(0).tickSizeInner(0),function(n,e){s(this,i),t.layout.xAxisTop.transition(e).call(t.xAxisTop),t.layout.xAxisBottom.transition(e).call(t.xAxisBottom),t.layout.xAxisTop.selectAll(".tick line").attr("stroke","#999").attr("stroke-opacity",.6),t.layout.xAxisTop.select(".domain").remove(),t.layout.xAxisBottom.select(".domain").remove()}.bind(this)}function q(t){var i=this,n=t.layout.labels.selectAll("text");return function(e,r){var o=this;s(this,i);var l=a(e,2);l[0];var c=l[1];n=n.data(c,function(t){return s(this,o),t.id}.bind(this)).join(function(i){var n=this;return s(this,o),i.append("text").attr("alignment-baseline","middle").attr("transform",function(i){return s(this,n),"translate(".concat(0,",",t.scale.y(i["rank".concat(t.stratum)]),")")}.bind(this)).attr("x",this.settings.margin.left+6).attr("y",t.scale.y.bandwidth()/2+1).text(function(t){return s(this,n),t.id}.bind(this))}.bind(this),function(t){return s(this,o),t}.bind(this),function(i){var n=this;return s(this,o),i.transition(r).remove().attr("transform",function(i){return s(this,n),"translate(".concat(0,",",t.scale.y(t.set.id.size+1),")")}.bind(this))}.bind(this)).call(function(i){var n=this;return s(this,o),i.transition(r).attr("transform",function(i){return s(this,n),"translate(".concat(0,",",t.scale.y(i["rank".concat(t.stratum)]),")")}.bind(this))}.bind(this))}.bind(this)}function I(t){var i=this;return function(n,e){var r=this;s(this,i);var o=a(n,1)[0];e.end().then(function(){s(this,r),t.layout.ticker.text("Day ".concat(o))}.bind(this))}.bind(this)}function N(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;null===this.settings.stratum_var&&(n=1);var e={stratum:i,i:n};return e.settings={width:Math.floor(this.settings.width*this.settings.splitFactor),margin:r(r({},this.settings.margin),{},{left:n%2==0?this.settings.margin.right:this.settings.margin.left,right:n%2==0?this.settings.margin.left:this.settings.margin.right}),textAnchor:e.i%2==0?"start":"end",sign:e.i%2==0?1:-1,mirror:e.i%2==0},e.settings.xRange=e.i%2==0?[e.settings.width-e.settings.margin.right,e.settings.margin.left]:[e.settings.margin.left,e.settings.width-e.settings.margin.right],e.settings.translateX=e.i%2==0?e.settings.width-e.settings.margin.right:e.settings.margin.left,e.settings.strokeWidth=0===n?e.settings.margin.right:e.settings.margin.left,e.layout=O.call(this,e),e.data=null===t?this.data:L.call(this,t,i),e.set={id:y.call(this,e.data.mutated)},e.scale={x:k.call(this,e.settings.xRange),y:_.call(this,e.set.id)},e.layout.n.text("n=".concat(e.set.id.size)),e.update={groups:z.call(this,e),bars:P.call(this,e),axis:T.call(this,e),labels:q.call(this,e),ticker:I.call(this,e)},e}function R(t){var i=this;this.settings.timepoint=t,this.data.timepoint=this.data.timepoints.find(function(n){return s(this,i),n[0]===t}.bind(this)),this.plots.forEach(function(n){var e=this;s(this,i),n.data.timepoint=n.data.timepoints.find(function(i){return s(this,e),i[0]===t}.bind(this))}.bind(this)),this.controls.range.input.property("value",t),this.controls.range.output.text("Day".concat(" ",this.settings.timepoint))}function C(){var t=this;this.set=j.call(this),this.scale=S.call(this),this.legend=A.call(this),this.plots=this.settings.stratum_var?d3.groups(this.data.mutated,function(i){return s(this,t),i.stratum}.bind(this)).map(function(i,n){s(this,t);var e=a(i,2),r=e[0],o=e[1];return N.call(this,o,r,n)}.bind(this)):[N.call(this)],D.call(this),!1===this.settings.play&&(this.break=!0)}function D(){return V.apply(this,arguments)}function V(){return(V=i(regeneratorRuntime.mark((function t(){var i,n,e,r,o,l,c,h=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=u(this.data.timepoints.filter(function(t){return s(this,h),t[0]>=this.settings.timepoint}.bind(this))),t.prev=1,i.s();case 3:if((n=i.n()).done){t.next=21;break}if(e=n.value,!this.break){t.next=9;break}return this.plots.forEach(function(t){s(this,h),t.layout.svg.interrupt(),t.layout.ticker.text("Day ".concat(this.settings.timepoint))}.bind(this)),delete this.break,t.abrupt("break",21);case 9:return R.call(this,e[0]),this.layout.ticker.text("Study Day ".concat(e[0])),r=this.data.interpolated.flatMap(function(t){return s(this,h),t["states".concat(this.settings.view)]}.bind(this)),o=d3.min(r,function(t){return s(this,h),t.start_timepoint}.bind(this)),l=d3.max(r,function(t){return s(this,h),t.start_timepoint+t.duration}.bind(this)),this.xDomain=[o,l],c=this.plots.map(function(t){var i=this;return s(this,h),t.data.timepoint=t.data.timepoints.find(function(t){s(this,i);var n=a(t,2),e=n[0];return n[1],e===this.settings.timepoint}.bind(this)),B.call(this,t)}.bind(this)),this.transition=c,t.next=19,Promise.allSettled(c.map(function(t){return s(this,h),t.end()}.bind(this)));case 19:t.next=3;break;case 21:t.next=26;break;case 23:t.prev=23,t.t0=t.catch(1),i.e(t.t0);case 26:return t.prev=26,i.f(),t.finish(26);case 29:case"end":return t.stop()}}),t,this,[[1,23,26,29]])})))).apply(this,arguments)}function B(t){var i=t.layout.svg.transition().duration(this.settings.duration).ease(d3.easeLinear);return t.scale.x.domain(this.xDomain),t.update.groups(t.data.timepoint,i),t.update.bars(t.data.timepoint,i),t.update.axis(t.data.timepoint,i),this.settings.displayIds&&t.update.labels(t.data.timepoint,i),i}!function(t){var i={exports:{}};t(i,i.exports)}((function(t){var i=function(t){var i,n=Object.prototype,e=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function l(t,i,n){return Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[i]}try{l({},"")}catch(t){l=function(t,i,n){return t[i]=n}}function c(t,i,n,e){var r=i&&i.prototype instanceof m?i:m,s=Object.create(r.prototype),a=new O(e||[]);return s._invoke=function(t,i,n){var e=h;return function(r,s){if(e===f)throw new Error("Generator is already running");if(e===g){if("throw"===r)throw s;return M()}for(n.method=r,n.arg=s;;){var a=n.delegate;if(a){var o=E(a,n);if(o){if(o===p)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(e===h)throw e=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);e=f;var l=u(t,i,n);if("normal"===l.type){if(e=n.done?g:d,l.arg===p)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(e=g,n.method="throw",n.arg=l.arg)}}}(t,n,a),s}function u(t,i,n){try{return{type:"normal",arg:t.call(i,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var h="suspendedStart",d="suspendedYield",f="executing",g="completed",p={};function m(){}function v(){}function b(){}var y={};y[s]=function(){return this};var x=Object.getPrototypeOf,w=x&&x(x(L([])));w&&w!==n&&e.call(w,s)&&(y=w);var j=b.prototype=m.prototype=Object.create(y);function k(t){["next","throw","return"].forEach((function(i){l(t,i,(function(t){return this._invoke(i,t)}))}))}function _(t,i){function n(r,s,a,o){var l=u(t[r],t,s);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==typeof h&&e.call(h,"__await")?i.resolve(h.__await).then((function(t){n("next",t,a,o)}),(function(t){n("throw",t,a,o)})):i.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,o)}))}o(l.arg)}var r;this._invoke=function(t,e){function s(){return new i((function(i,r){n(t,e,i,r)}))}return r=r?r.then(s,s):s()}}function E(t,n){var e=t.iterator[n.method];if(e===i){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=i,E(t,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=u(e,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,p;var s=r.arg;return s?s.done?(n[t.resultName]=s.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=i),n.delegate=null,p):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function S(t){var i={tryLoc:t[0]};1 in t&&(i.catchLoc=t[1]),2 in t&&(i.finallyLoc=t[2],i.afterLoc=t[3]),this.tryEntries.push(i)}function A(t){var i=t.completion||{};i.type="normal",delete i.arg,t.completion=i}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function L(t){if(t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(e.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=i,n.done=!0,n};return a.next=a}}return{next:M}}function M(){return{value:i,done:!0}}return v.prototype=j.constructor=b,b.constructor=v,v.displayName=l(b,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var i="function"==typeof t&&t.constructor;return!!i&&(i===v||"GeneratorFunction"===(i.displayName||i.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,l(t,o,"GeneratorFunction")),t.prototype=Object.create(j),t},t.awrap=function(t){return{__await:t}},k(_.prototype),_.prototype[a]=function(){return this},t.AsyncIterator=_,t.async=function(i,n,e,r,s){void 0===s&&(s=Promise);var a=new _(c(i,n,e,r),s);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(j),l(j,o,"Generator"),j[s]=function(){return this},j.toString=function(){return"[object Generator]"},t.keys=function(t){var i=[];for(var n in t)i.push(n);return i.reverse(),function n(){for(;i.length;){var e=i.pop();if(e in t)return n.value=e,n.done=!1,n}return n.done=!0,n}},t.values=L,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&e.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=i)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(e,r){return o.type="throw",o.arg=t,n.next=e,r&&(n.method="next",n.arg=i),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=e.call(a,"catchLoc"),c=e.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,i){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&e.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=i&&i<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=t,a.arg=i,s?(this.method="next",this.next=s.finallyLoc,p):this.complete(a)},complete:function(t,i){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&i&&(this.next=i),p},finish:function(t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),A(n),p}},catch:function(t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc===t){var e=n.completion;if("throw"===e.type){var r=e.arg;A(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:L(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=i),p}},t}(t.exports);try{regeneratorRuntime=i}catch(t){Function("r","regeneratorRuntime = r")(i)}}));var F={playPause:function(t){var i=this,n=this.util.addElement("button",t,"button").attr("type","button").attr("title",this.settings.play?"Pause animation":"Play animation");return this.util.addIcon.call(this,n,(this.settings.play?f:g).icon),n.on("click",function(){s(this,i),b.call(this),!1===this.settings.play&&void 0===this.break?this.break=!0:(delete this.break,D.call(this))}.bind(this)),n},stepBackward:function(t){var i=this,n=this.util.addElement("button",t,"button").attr("type","button").attr("title","Step backward one timepoint");return this.util.addIcon.call(this,n,m),n.on("click",function(){var t=this;s(this,i),this.break=!0,this.settings.play&&b.call(this),d3.timeout(function(){var i=this;s(this,t),R.call(this,this.settings.timepoint-1),this.plots.forEach(function(t){s(this,i),B.call(this,t)}.bind(this))}.bind(this),this.settings.duration)}.bind(this)),n},stepForward:function(t){var i=this,n=this.util.addElement("button",t,"button").attr("type","button").attr("title","Step forward one timepoint");return this.util.addIcon.call(this,n,v),n.on("click",function(){var t=this;s(this,i),this.break=!0,this.settings.play&&b.call(this),d3.timeout(function(){var i=this;s(this,t),R.call(this,this.settings.timepoint+1),this.plots.forEach(function(t){s(this,i),B.call(this,t)}.bind(this))}.bind(this),this.settings.duration)}.bind(this)),n},reset:function(t){var i=this,n=this.util.addElement("button",t,"button").attr("type","button").attr("title","Restart animation");return this.util.addIcon.call(this,n,p),n.on("click",function(){var t=this;s(this,i),console.log("reset"),this.break=!0,d3.timeout(function(){var i=this;s(this,t),R.call(this,this.settings.timepointMin),this.plots.forEach(function(t){s(this,i),B.call(this,t)}.bind(this)),this.settings.play&&D.call(this)}.bind(this),this.settings.duration)}.bind(this)),n},range:function(t){var i=this,n=this.util.addElement("label",t,"label"),e=this.util.addElement("output",n,"output"),r=this.util.addElement("input",n,"input").attr("type","range").attr("step",1);return r.on("mousedown",(function(){i.break=!0,i.settings.play&&b.call(i)})),r.on("change",(function(){var t=this;console.log(this.value),i.break=!0,i.settings.play&&b.call(i),R.call(i,+this.value),i.plots.forEach(function(n){s(this,t),B.call(i,n)}.bind(this))})),{input:r,output:e}}};function U(t){var i=this.util.addElement("player",t),n=this.util.addElement("player__form",i,"form"),e={};for(var r in F)e[r]=F[r].call(this,n);return e}function G(){return[{setting:"OverallSurvival",value:"overall-survival",label:"Overall Survival"},{setting:"CurrentResponse",value:"current-response",label:"Current Response"}]}function W(t){var i=this,n=this.util.addElement("view",t),e=this.util.addElement("view__form",n,"form");e.append("span").text("View");var r=this.util.addElement("div",e).selectAll("input").data(G).join("input").attr("type","radio").attr("name","view").attr("value",function(t){return s(this,i),t.value}.bind(this)).property("checked",function(t){return s(this,i),t.setting===this.settings.view}.bind(this)).each((function(t){var i=document.createElement("label");i.textContent=t.label,this.parentNode.insertBefore(i,this)}));return r.on("change",function(){var t=this;s(this,i);var n=e.selectAll("input:checked").datum();console.log("view: ".concat(n.setting)),this.settings.view=n.setting;var r=this.data.interpolated.flatMap(function(i){return s(this,t),i["states".concat(this.settings.view)]}.bind(this)),o=d3.min(r,function(i){return s(this,t),i.start_timepoint}.bind(this)),l=d3.max(r,function(i){return s(this,t),i.start_timepoint+i.duration}.bind(this));this.xDomain=[o,l],this.plots.forEach(function(i){var n=this;s(this,t),i.data.timepoints.forEach(function(t){var e=this;s(this,n);var r=a(t,2);r[0];var o=r[1];o.sort(function(t,i){return s(this,e),t["rank".concat(this.settings.view)]-i["rank".concat(this.settings.view)]}.bind(this)),o.forEach(function(t,n){s(this,e),t["rank".concat(i.stratum)]=n}.bind(this))}.bind(this))}.bind(this)),!1===this.settings.play&&this.plots.forEach(function(i){s(this,t),B.call(this,i)}.bind(this))}.bind(this)),r}function X(t){var i=this.util.addElement("controls",t);return{controls:i,view:W.call(this,i),player:U.call(this,i)}}function Y(){var t=this;this.settings.dimensions=d.call(this,this.layout.main),this.settings.width=this.settings.dimensions.width,this.settings.height=this.settings.dimensions.height,this.plots.forEach(function(i){var n=this;s(this,t),i.settings.width=Math.floor(this.settings.width*this.settings.splitFactor),i.settings.xRange=i.i%2==0?[i.settings.width-i.settings.margin.right,i.settings.margin.left]:[i.settings.margin.left,i.settings.width-i.settings.margin.right],i.settings.translateX=i.i%2==0?i.settings.width-i.settings.margin.right:i.settings.margin.left,i.layout.svg.attr("width",i.settings.width).attr("height",this.settings.height),i.layout.title.attr("transform",function(t){return s(this,n),"translate(".concat(i.settings.margin.left+(i.settings.width-i.settings.margin.right-i.settings.margin.left)/2,",").concat(i.settings.margin.top/2,")")}.bind(this)),i.layout.xAxisTop.call(function(t){return s(this,n),t.select(".asp-x-axis__label").attr("x",i.settings.mirror?i.settings.width-i.settings.margin.right-18:i.settings.margin.left+18)}.bind(this)),i.layout.xAxisBottom.call(function(t){return s(this,n),t.select(".asp-x-axis__label").attr("x",i.settings.mirror?i.settings.width-i.settings.margin.right-18:i.settings.margin.left+18)}.bind(this)),i.layout.ticker.attr("x",i.settings.mirror?i.settings.margin.left+18:i.settings.width-i.settings.margin.right-18),i.scale.x.range(i.settings.xRange),i.xAxisTop=d3.axisTop(i.scale.x).ticks(this.settings.width/160).tickSizeOuter(0).tickSizeInner(-(this.settings.height-this.settings.margin.top-this.settings.margin.bottom)),i.xAxisBottom=d3.axisBottom(i.scale.x).ticks(this.settings.width/160).tickSizeOuter(0).tickSizeInner(0),i.scale.y.range([this.settings.height-this.settings.margin.bottom,this.settings.margin.top])}.bind(this))}function $(){var t=this.util.addElement("main",d3.select(this.element)),i=d.call(this,t);this.settings.width=i.width,this.settings.height=i.height;var n=this.util.addElement("legend",t),e=this.util.addElement("plots",t),s=this.util.addElement("ticker",e),a=X.call(this,t);return window.addEventListener("resize",Y.bind(this)),r({main:t,legend:n,plots:e,ticker:s},a)}function H(t){var i=this,n=t.map(function(t){var n=this;s(this,i);var e,r={},a=u(Object.keys(this.settings).filter(function(t){return s(this,n),/_var$/.test(t)}.bind(this)));try{for(a.s();!(e=a.n()).done;){var o=e.value,l=o.replace(/_var$/,"");r[l]=["timepoint","duration","censor_timepoint","result_order","visit_order"].includes(l)?+t[this.settings[o]]:t[this.settings[o]]}}catch(t){a.e(t)}finally{a.f()}return r.result_order=void 0!==t[this.settings.result_order_var]?t[this.settings.result_order_var]:"CR"===r.result?0:"PR"===r.result?1:"SD"===r.result?2:"NE"===r.result?3:"UN"===r.result?4:"PD"===r.result?5:null,r.result_color=void 0!==t[this.settings.result_color_var]?t[this.settings.result_color_var]:"CR"===r.result?"#2166ac":"PR"===r.result?"#4393c3":"SD"===r.result?"#92c5de":"NE"===r.result?"#969696":"UN"===r.result?"#bdbdbd":"PD"===r.result?"#d6604d":null,r}.bind(this));return d3.rollup(n,function(t){var n=this;s(this,i),t.sort(function(t,i){return s(this,n),t.timepoint-i.timepoint}.bind(this)),d3.pairs(t).forEach(function(t,i,e){s(this,n),isNaN(t[0].duration)&&(t[0].duration=t[1].timepoint-t[0].timepoint)}.bind(this));var e=t[t.length-1];isNaN(e.duration)&&(e.duration=void 0!==e.censor_timepoint?e.censor_timepoint-e.timepoint:1)}.bind(this),function(t){return s(this,i),t.id}.bind(this)),n}function J(t){var i=this,n=0;return t.map(function(t){return s(this,i),r({},t)}.bind(this)).reverse().map(function(t,e,r){return s(this,i),0===e?t.start_timepoint=1:(t.duration=t.duration,n-=t.duration,t.start_timepoint=n),t}.bind(this))}function K(t){var i=this;return o(d3.rollup(t,function(t){var n=this;s(this,i);var e,a,o=[],l=[],c=d3.min(t,function(t){return s(this,n),t.timepoint}.bind(this)),u=0;return t.sort(function(t,i){return s(this,n),t.timepoint-i.timepoint}.bind(this)).forEach(function(i,h){var d=this;s(this,n),0!==h&&i.result===t[h-1].result||(e=i.result,a=0,l.push({state:e,start_timepoint:c,duration:0,sequence:u}),u++);for(var f=0;f<i.duration;f++){var g=r({},i);g.timepoint=g.timepoint+f,g.duration=a+f+1,g.total_duration=c+f+1,l[l.length-1].duration++,g.statesOverallSurvival=l.map(function(t){return s(this,d),r({},t)}.bind(this)),g.statesCurrentResponse=J(g.statesOverallSurvival),g.state=g.result,g.state_order=g.result_order,o.push(g)}a+=i.duration,c+=i.duration}.bind(this)),o}.bind(this),function(t){return s(this,i),t.id}.bind(this)).values()).flatMap(function(t){return s(this,i),t}.bind(this))}function Q(t,i){var n=this;return d3.rollups(t,function(t){var e=this;s(this,n);var o=new Set(t.map(function(t){return s(this,e),t.id}.bind(this)));return i.forEach(function(i){s(this,e);var n=a(i,2),l=n[0],c=n[1];!1===o.has(l)&&t.push(r({},c))}.bind(this)),t.sort(function(t,i){s(this,e);var n=t.state_order-i.state_order,r=i.total_duration-t.total_duration,a=i.duration-t.duration,o=t.id<i.id?-1:1;return n||r||a||o}.bind(this)).forEach(function(t,i){s(this,e),t.rankOverallSurvival=i}.bind(this)),t.sort(function(t,i){s(this,e);var n=t.state_order-i.state_order,r=i.duration-t.duration,a=t.total_duration-i.total_duration,o=t.id<i.id?-1:1;return n||r||a||o}.bind(this)).forEach(function(t,i){s(this,e),t.rankCurrentResponse=i}.bind(this)),t.sort(function(t,i){return s(this,e),t["rank".concat(this.settings.view)]-i["rank".concat(this.settings.view)]}.bind(this)).forEach(function(t,i){s(this,e),t.rank=i}.bind(this)),t}.bind(this),function(t){return s(this,n),t.timepoint}.bind(this))}function Z(t){var i=this,n=H.call(this,t),e=K.call(this,n),r=d3.rollups(e,function(t){return s(this,i),t[t.length-1]}.bind(this),function(t){return s(this,i),t.id}.bind(this));return{data:t,mutated:n,interpolated:e,finalTimepoint:r,timepoints:Q.call(this,e,r)}}function tt(){var t=this,i=r(r({container:this.layout.controls,player:this.layout.player},this.layout.player),{},{view:this.layout.view});return this.settings.timepointMin=d3.min(this.data.timepoints,function(i){return s(this,t),a(i,1)[0]}.bind(this)),this.settings.timepointMax=d3.max(this.data.timepoints,function(i){return s(this,t),a(i,1)[0]}.bind(this)),this.settings.timepoint=void 0!==this.settings.timepoint&&this.settings.timepoint>=this.settings.timepointMin&&this.settings.timepoint<=this.settings.timepointMax?this.settings.timepoint:this.settings.timepointMin,i.range.input.attr("min",this.settings.timepointMin).attr("max",this.settings.timepointMax).attr("value",this.settings.timepoint),i.range.output.text("".concat(this.settings.timepointUnit," ").concat(this.settings.timepoint)),i}return function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e={element:i,settings:Object.assign({id_var:"USUBJID",timepoint_var:"ADY",duration_var:"ADUR",censor_var:"CNSR",censor_timepoint_var:"CNSRDY",result_var:"AVALC",result_order_var:"AVAL",result_color_var:"ACOLOR",visit_var:"AVISIT",visit_order_var:"AVISITN",stratum_var:null,view:"OverallSurvival",split:"vertical",splitFactor:1,play:!0,timepoint:0,timepointUnit:"day",timepointMin:null,timepointMax:null,duration:250,speedFactor:50,dimensions:{width:null,height:null},margin:{top:60,right:10,bottom:50,left:125},padding:.1,buttonSize:50,barSize:null,displayIds:!1,criteria:"RECIST",update:function(){return this.stratum_var&&(this.split="horizontal",this.splitFactor=.5),this}},n).update(),util:h};return e.layout=$.call(e),e.data=Z.call(e,t),e.controls=tt.call(e),C.call(e),e}}));
